<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï∫òÎ¶∞Îçî</title>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #calendar { max-width: 900px; margin: 50px auto; }
    </style>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.0.0/mdb.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.0.0/mdb.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body>


<h1>Ï∫òÎ¶∞Îçî</h1>

<p th:text="'Logged in as : ' + ${userEmail}"></p>
<p th:text="'Logged id : ' + ${memberId}"></p>
<p th:text="'userWeight : ' + ${userWeight}"></p>
<a href="/logout">Logout</a>
<input type="hidden" id="memberId" th:value="${memberId}" />
<input type="hidden" id="userWeight" onkeyup="calculateCalories()" th:value="${userWeight}"  />


<div id="calendar"></div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>


<script>

    function openSelectFoodWindow() {
        window.open("/select_food", "SelectFood", "width=600,height=400,scrollbars=yes,resizable=yes");
    }

    function openSelectExerciseWindow() {
        window.open("/select_exercise", "SelectExercise", "width=600,height=400,scrollbars=yes,resizable=yes");
    }

</script>

<script>
    function calculateCalories(id = null) {
        let time = id ? $(`#exerciseTime_${id}`).val() : $("#exerciseTime").val();
        let weight = $("#userWeight").val();
        let energyConsumption = id ? $(`#energy_consumption_${id}`).val() : $("#energy_consumption").val();

        if (time && weight && energyConsumption) {
            let calories = energyConsumption * 3.5 * weight * time * 0.005;
            if (id) {
                $(`#exerciseCalories_${id}`).val(calories.toFixed(2));
            } else {
                $("#exerciseCalories").val(calories.toFixed(2));
            }
        }
    }

    // üîπ Ïö¥Îèô ÏÑ†ÌÉù Ïãú energy_consumption ÏóÖÎç∞Ïù¥Ìä∏
    function updateEnergyConsumption(id = null) {
        let energyConsumptionValue = $("#selectedExerciseEnergy").val();
        if (id) {
            $(`#energy_consumption_${id}`).val(energyConsumptionValue);
            calculateCalories(id);
        } else {
            $("#energy_consumption").val(energyConsumptionValue);
            calculateCalories();
        }
    }
</script>



<script>

    function calculateFoodCalories(id = null) {
        let hundredGram = id ? $(`#foodHundredGram_${id}`).val() : $("#foodHundredGram").val();
        let foodConsumption = id ? $(`#food_consumption_${id}`).val() : $("#food_consumption").val();

        if (hundredGram && foodConsumption) {
            let calories = (hundredGram * foodConsumption * 0.01);
            console.log("ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞ : " + calories);
            if (id) {
                $(`#foodCalories_${id}`).val(calories.toFixed(2));
            } else {
                $("#foodCalories").val(calories.toFixed(2));
            }
        }
    }

    function updateFoodConsumption(id = null) {
        let foodConsumptionValue = $("#selectedFoodEnergy").val();

        // ÌôïÏù∏: foodConsumptionValueÍ∞Ä Ïûò ÏÑ§Ï†ïÎêòÏóàÎäîÏßÄ ÌôïÏù∏
        console.log("foodConsumptionValue: ", foodConsumptionValue);

        if (id) {
            $(`#food_consumption_${id}`).val(foodConsumptionValue); // foodConsumption Í∞í Í∞±Ïã†
            calculateFoodCalories(id);  // foodConsumption Í∞íÏúºÎ°ú ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞
        } else {
            $("#food_consumption").val(foodConsumptionValue);
            calculateFoodCalories();  // foodConsumption Í∞íÏúºÎ°ú ÏπºÎ°úÎ¶¨ Í≥ÑÏÇ∞
        }
    }
</script>



<script>

    function saveMemo(selectedDate, memberId) {
        let title = $("#memoTitle").val();
        let context = $("#memoContent").val();

        $.ajax({
            url: "/memo/date/post",
            method: "POST",
            data: {
                title: title,
                context: context,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function() {
                alert("Î©îÎ™® Ï†ÄÏû• Ïã§Ìå®");
            }
        });
    }

    function updateMemo(memoId, selectedDate, memberId) {
        let title = $(`#memoTitle_${memoId}`).val(); // Í∞Å Î©îÎ™®Ïùò IDÎ•º Í∞ÄÏ†∏Ïò§Í∏∞
        let context = $(`#memoContent_${memoId}`).val();
        console.log("Í∞ÄÏ†∏Ïò® Í∞í : "+title+context);

        $.ajax({
            url: "/memo/date/put",
            method: "PUT",
            data: {
                id: memoId,
                title: title,
                context: context,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("Î©îÎ™® ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: " + xhr.responseText);
            }
        });
    }

    function deleteMemo(memoId) {

        $.ajax({
            url: "/memo/date/delete",
            method: "DELETE",
            data: {
                id: memoId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("Î©îÎ™® ÏÇ≠Ï†ú Ïã§Ìå®: " + xhr.responseText);
            }
        });
    }

    function saveFood(selectedDate, memberId) {
        let name = $("#foodName").val();
        let hundredGram = $("#foodHundredGram").val();
        let calories = $("#foodCalories").val();

        $.ajax({
            url: "/food/date/post",
            method: "POST",
            data: {
                name: name,
                hundredGram: hundredGram,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function() {
                alert("ÏãùÎã® Ï†ÄÏû• Ïã§Ìå®");
            }
        });
    }

    function updateFood(foodId, selectedDate, memberId) {
        let name = $(`#foodName_${foodId}`).val(); // Í∞Å Î©îÎ™®Ïùò IDÎ•º Í∞ÄÏ†∏Ïò§Í∏∞
        let hundredGram = $(`#foodHundredGram_${foodId}`).val();
        let calories = $(`#foodCalories_${foodId}`).val();


        $.ajax({
            url: "/food/date/put",
            method: "PUT",
            data: {
                id: foodId,
                name: name,
                hundredGram: hundredGram,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ÏãùÎã® ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: " + xhr.responseText);
            }
        });
    }

    function deleteFood(foodId) {

        $.ajax({
            url: "/food/date/delete",
            method: "DELETE",
            data: {
                id: foodId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ÏãùÎã® ÏÇ≠Ï†ú Ïã§Ìå®: " + xhr.responseText);
            }
        });
    }

    function saveExercise(selectedDate, memberId) {
        let name = $("#exerciseName").val();
        let time = $("#exerciseTime").val();
        let calories = $("#exerciseCalories").val();

        $.ajax({
            url: "/exercise/date/post",
            method: "POST",
            data: {
                name: name,
                time: time,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {},
            error: function() {
                alert("Ïö¥Îèô Ï†ÄÏû• Ïã§Ìå®");
            }
        });
    }


    function updateExercise(exerciseId, selectedDate, memberId) {
        let name = $(`#exerciseName_${exerciseId}`).val(); // Í∞Å Î©îÎ™®Ïùò IDÎ•º Í∞ÄÏ†∏Ïò§Í∏∞
        let time = $(`#exerciseTime_${exerciseId}`).val();
        let calories = $(`#exerciseCalories_${exerciseId}`).val();

        $.ajax({
            url: "/exercise/date/put",
            method: "PUT",
            data: {
                id: exerciseId,
                name: name,
                time: time,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("Ïö¥Îèô ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®: " + xhr.responseText);
            }
        });
    }

    function deleteExercise(exerciseId) {

        $.ajax({
            url: "/exercise/date/delete",
            method: "DELETE",
            data: {
                id: exerciseId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("Ïö¥Îèô ÏÇ≠Ï†ú Ïã§Ìå®: " + xhr.responseText);
            }
        });
    }

    
    document.addEventListener("DOMContentLoaded", function () {

        let status = "";
        let calendarEl = document.getElementById("calendar");
        let calendar = new FullCalendar.Calendar(calendarEl, {
            themeSystem: 'bootstrap5',
            locale: "en",
            initialView: 'dayGridMonth',
            editable: false,
            selectable: false,
            navLinks: true,

            navLinkDayClick: function (date, jsEvent) {
                // ÌÉÄÏûÑÏ°¥ Ïò§ÌîÑÏÖãÏùÑ Î∞ÄÎ¶¨Ï¥à Îã®ÏúÑÎ°ú Í≥ÑÏÇ∞
                let timezoneOffset = date.getTimezoneOffset() * 60000; // Î∂Ñ Îã®ÏúÑ Ïò§ÌîÑÏÖãÏùÑ Î∞ÄÎ¶¨Ï¥àÎ°ú Î≥ÄÌôò

                // ÏãúÍ∞ÑÎåÄ Ï°∞Ï†ï: ÌÅ¥Î¶≠Ìïú ÎÇ†ÏßúÏóêÏÑú ÌÉÄÏûÑÏ°¥ Ïò§ÌîÑÏÖãÏùÑ Ï†ÅÏö©
                let adjustedDate = new Date(date.getTime() - timezoneOffset); // Ïò§ÌîÑÏÖãÏùÑ ÎπºÏÑú UTC ÏãúÍ∞ÑÏúºÎ°ú Î≥ÄÌôò

                if (this.view.type === "multiMonthYear") {
                    this.changeView("dayGridMonth"); // ÏõîÎ≥Ñ Î≥¥Í∏∞Î°ú Î≥ÄÍ≤Ω
                    this.gotoDate(adjustedDate); // Ï°∞Ï†ïÎêú ÎÇ†ÏßúÎ°ú Ïù¥Îèô
                } else if (status == 1) {
                    loadLesson2Events(adjustedDate);
                } else if (status == 2) {
                    Food2Action(adjustedDate);
                } else if (status == 3) {
                    Exercise2Action(adjustedDate);
                } else if (status == 4) {
                    Memo2Action(adjustedDate);
                } else {
                    status = "";
                    alert("modal");
                }

                // ÎÇ†ÏßúÏôÄ Ï¢åÌëú Ï∂úÎ†•
                console.log('day', adjustedDate.toISOString());
                console.log('coords', jsEvent.pageX, jsEvent.pageY);
            },

            headerToolbar: {
                left: 'today LessonButton FoodButton ExerButton MemoButton',
                center: 'title',
                right: 'prev,next,multiMonthYear'
            },

            customButtons: {
                LessonButton: {text: 'Í∞ïÏùò', click: loadLessonEvents},
                FoodButton: {text: 'ÏùåÏãù', click: FoodAction},
                ExerButton: {text: 'Ïö¥Îèô', click: ExerciseAction},
                MemoButton: {text: 'Î©îÎ™®', click: MemoAction},
                multiMonthYear: {
                    icon: "bi bi-calendar",
                    click: function() {
                        calendar.changeView("multiMonthYear");
                    }
                }
            }
        });

        function loadLessonEvents() {
            status = 1;
            let memberId = document.getElementById('memberId').value;
            $.ajax({
                url: '/lesson',
                method: 'GET',
                data: { memberId: memberId },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let events = data.map(item => ({
                        title: item.title,
                        start: new Date(item.date),
                        end: new Date(new Date(item.date).setHours(new Date(item.date).getHours() + 2)),
                        description: `${item.startTime} - ${item.endTime}`,
                        allDay: true
                    }));

                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            });
        }

        function loadLesson2Events(date) {
            let selectedDate = date.toISOString().split('T')[0]; // 'YYYY-MM-DD' ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
            let memberId = document.getElementById('memberId').value;
            console.log("ÏÑ†ÌÉùÌïú ÎÇ†Ïßú:", selectedDate);

            $.ajax({
                url: '/lesson/date', // API ÏóîÎìúÌè¨Ïù∏Ìä∏ ÏàòÏ†ï
                method: 'GET',
                data: {
                    memberId: memberId, // ÌöåÏõê ID Ï†ÑÎã¨
                    date: selectedDate // ÏÑ†ÌÉùÌïú ÎÇ†Ïßú Ï†ÑÎã¨
                },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let content = `<strong>${selectedDate}Ïùò Í∞ïÏùò ÏùºÏ†ï</strong><br>`;
                    if (data.length > 0) {
                        data.forEach(item => {
                            content += `<strong>${item.title}</strong> (${item.startTime} ~ ${item.endTime})`;
                            content += `<input type="button" class="lessonDetailBtn btn btn-info mt-2" value="Í∞ïÏùò ÏÉÅÏÑ∏Î≥¥Í∏∞" data-id="${item.id}" /><br>`;
                        });
                    } else {
                        content += "Ìï¥Îãπ ÎÇ†ÏßúÏóê ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§.";
                    }

                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞

                    $(".lessonDetailBtn").on("click", function () {
                        let id = $(this).data("id");
                        window.location.href = `/detail/${id}`; // Í∞ïÏùò ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïù¥Îèô
                    });
                },
                error: function () {
                    $("#modalContent").html("ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞
                }
            });
        }

        function MemoAction() {
            status = 4;
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/memo',
                method: 'GET',
                data: { memberId: memberId },
                success: function (data) {
                    let events = data.map(item => ({
                        title: item.title,
                        start: new Date(item.date),
                        description: item.context || "",
                        allDay: true
                    }));
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('Î©îÎ™®Î•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            });
        }


        function Memo2Action(date) {
            let selectedDate = date.toISOString().split('T')[0];
            let memberId = document.getElementById('memberId').value;
            console.log("Î∞õÏùÄ ÎÇ†Ïßú:", selectedDate);

            $.ajax({
                url: '/memo/date',
                method: 'GET',
                data: {
                    date: selectedDate,
                    memberId: memberId
                },
                success: function (data) {
                    console.log('Received Memos:', data);

                    let content = `<strong>${selectedDate}Ïùò Î©îÎ™®</strong><br>`;

                    if (data.length > 0) {
                        // Í∏∞Ï°¥ Î©îÎ™®Í∞Ä ÏûàÏùÑ Í≤ΩÏö∞ ÏàòÏ†ï UI ÏÉùÏÑ±
                        data.forEach(item => {
                            content += `<strong>Î©îÎ™® ÏàòÏ†ï</strong><br>`;
                            content += `Ï†úÎ™© : <input type="text" id="memoTitle_${item.id}" value="${item.title}" /><br>`;
                            content += `ÎÇ¥Ïö© : <textarea id="memoContent_${item.id}">${item.context}</textarea><br>`;
                            content += `<button onclick="updateMemo(${item.id}, '${selectedDate}', ${memberId})">ÏàòÏ†ï</button>`;
                            content += `<button onclick="deleteMemo(${item.id})">ÏÇ≠Ï†ú</button>`;
                        });

                    } else {
                        // Í∏∞Ï°¥ Î©îÎ™®Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞ ÏûÖÎ†• Ìèº Ï∂îÍ∞Ä
                        content += `<strong>ÏÉà Î©îÎ™® Ï∂îÍ∞Ä</strong><br>`;
                        content += `Ï†úÎ™© : <input type="text" id="memoTitle" placeholder="Ï†úÎ™© ÏûÖÎ†•"> <br>`;
                        content += `ÎÇ¥Ïö© : <textarea id="memoContent" placeholder="ÎÇ¥Ïö© ÏûÖÎ†•"></textarea> <br>`;
                        content += `<button onclick="saveMemo('${selectedDate}', ${memberId})">Ï†ÄÏû•</button>`;
                    }

                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞

                },
                error: function () {
                    $("#modalContent").html("Î©îÎ™®Î•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞
                }
            });
        }


        function ExerciseAction() {
            status = 3;
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/exercise',  // Ïã§Ï†ú API URLÎ°ú Î≥ÄÍ≤Ω
                method: 'GET',
                data: { memberId: memberId },
                success: function (data) {
                    let events = data.map(item => ({
                        title: item.name,
                        start: new Date(item.date),
                        description: item.context || "",
                        allDay: true
                    }));
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            });
        }

        function Exercise2Action(date) {
            let selectedDate = date.toISOString().split('T')[0];
            let memberId = document.getElementById('memberId').value;
            console.log("Î∞õÏùÄÎÇ†Ïßú", selectedDate);

            $.ajax({
                url: '/exercise/date',
                method: 'GET',
                data: {
                    date: selectedDate,
                    memberId: memberId
                },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let content = `<strong>${selectedDate}Ïùò Ïö¥Îèô</strong><br>`;
                    let energyConsumptionValue = $("#selectedExerciseEnergy").val(); // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï

                    if (data.length > 0) {
                        data.forEach(item => {
                            content += `<strong>Ïö¥Îèô ÏàòÏ†ï</strong><br>`;
                            content += `Ïö¥ÎèôÎ™Ö : <input type="text" class="exerciseName" id="exerciseName_${item.id}" value="${item.name}" onkeyup="updateEnergyConsumption(${item.id})" disabled/><br>`;
                            content += `Ïö¥ÎèôÏãúÍ∞Ñ : <input type="text" class="exerciseTime" id="exerciseTime_${item.id}" value="${item.time}" onkeyup="calculateCalories(${item.id})" onfocus="calculateCalories(${item.id})"/>`;
                            content += `<input type="text" class="energyConsumption" id="energy_consumption_${item.id}" value="${energyConsumptionValue}" disabled/><br>`;
                            content += `Ïö¥Îèô ÏπºÎ°úÎ¶¨ : <input type="text" id="exerciseCalories_${item.id}" value="${item.calories}" onkeyup="calculateCalories()" disabled /><br>`;
                            content += `<button onclick="updateExercise(${item.id}, '${selectedDate}', ${memberId})">ÏàòÏ†ï</button>`;
                            content += `<button onclick="deleteExercise(${item.id})">ÏÇ≠Ï†ú</button>`;

                            $("#modalContent").html(content);


                            let selectedExerciseName = $(`#exerciseName_${item.id}`).val();
                            console.log(selectedExerciseName);

                            // /api/exercise/search Ìò∏Ï∂ú
                            $.ajax({
                                url: "/api/exercise/search",
                                method: "GET",
                                data: { name: selectedExerciseName },
                                success: function (responseData) {
                                    // Î∞∞Ïó¥Ïù¥ Î∞òÌôòÎêòÏóàÏúºÎØÄÎ°ú Ï≤´ Î≤àÏß∏ ÏöîÏÜåÎ•º Í∞ÄÏ†∏ÏôÄÏÑú 'energyConsumption' Í∞íÏùÑ Ï∂îÏ∂ú
                                    if (responseData && responseData.length > 0) {
                                        let energyConsumption = responseData[0].energyConsumption;  // Ï≤´ Î≤àÏß∏ ÏöîÏÜåÏùò energyConsumption Í∞í
                                        console.log(energyConsumption);  // energyConsumption Í∞í ÌôïÏù∏

                                        // energyConsumption Í∞íÏùÑ ÌôîÎ©¥Ïóê Î∞òÏòÅ
                                        $(`#energy_consumption_${item.id}`).val(energyConsumption);
                                    } else {
                                        // Í∞íÏù¥ ÏóÜÏúºÎ©¥ Îπà Í∞í Ï≤òÎ¶¨
                                        $(`#energy_consumption_${item.id}`).val('');
                                    }
                                },
                                error: function (error) {
                                    console.error("Error fetching energy consumption:", error);
                                }
                            });
                        });
                    } else {
                        content += `<strong>ÏÉà Ïö¥Îèô Ï∂îÍ∞Ä</strong><br>`;
                        content += `Ïö¥ÎèôÎ™Ö : <input type="text" class="exerciseName" id="exerciseName" onkeyup="updateEnergyConsumption()" disabled/><br>`;
                        content += `Ïö¥ÎèôÏãúÍ∞Ñ : <input type="text" class="exerciseTime" id="exerciseTime" onkeyup="calculateCalories()" onfocus="calculateCalories()"/>`;
                        content += `<input type="text" class="energyConsumption" id="energy_consumption" value="${energyConsumptionValue}" disabled/><br>`;
                        content += `Ïö¥Îèô ÏπºÎ°úÎ¶¨ : <input type="text" id="exerciseCalories" onkeyup="calculateCalories()" disabled /><br>`;
                        content += `<button onclick="saveExercise('${selectedDate}', ${memberId})">Ï†ÄÏû•</button>`;
                    }

                    content += `<button onClick="openSelectExerciseWindow()">Ïö¥Îèô ÏÑ†ÌÉù</button>`;

                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞
                },
                error: function () {
                    $("#modalContent").html("ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞
                }
            });
        }


        function FoodAction() {
            status = 2;
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/food',  // Ïã§Ï†ú API URLÎ°ú Î≥ÄÍ≤Ω
                method: 'GET',
                data: {memberId: memberId},
                success: function (data) {
                    let events = data.map(item => ({
                        title: item.name,
                        start: new Date(item.date),
                        description: item.context || "",
                        allDay: true
                    }));
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            });
        }

        function Food2Action(date) {
            let selectedDate = date.toISOString().split('T')[0];
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/food/date',
                method: 'GET',
                data: {
                    date: selectedDate,
                    memberId: memberId
                },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let content = `<strong>${selectedDate}Ïùò ÏãùÎã®</strong><br>`;
                    let foodConsumptionValue = $("#selectedFoodEnergy").val(); // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï


                    if (data.length > 0) {
                        data.forEach(item => {
                            content += `<strong>ÏãùÎã® ÏàòÏ†ï</strong><br>`;
                            content += `ÏùåÏãùÎ™Ö : <input type="text" class="foodName" id="foodName_${item.id}" value="${item.name}" onkeyup="updateFoodConsumption(${item.id})" disabled /><br>`;
                            content += `<input type="text" class="foodConsumption" id="food_consumption_${item.id}" value="${foodConsumptionValue}" disabled/><br>`;
                            content += `ÏÑ≠Ï∑®Îüâ : <input type="text" class="foodHundredGram" id="foodHundredGram_${item.id}" value="${item.hundredGram}" onkeyup="calculateFoodCalories(${item.id})" onfocus="calculateFoodCalories(${item.id})" /><br>`;
                            content += `ÏÑ≠Ï∑® ÏπºÎ°úÎ¶¨ : <input type="text" id="foodCalories_${item.id}" value="${item.calories}" disabled onkeyup="calculateFoodCalories(${item.id})" /><br>`;
                            content += `<button onclick="updateFood(${item.id}, '${selectedDate}', ${memberId})">ÏàòÏ†ï</button>`;
                            content += `<button onclick="deleteFood(${item.id})">ÏÇ≠Ï†ú</button>`;

                            $("#modalContent").html(content);

                            let selectedFoodName = $(`#foodName_${item.id}`).val();
                            console.log(selectedFoodName);


                            // /api/exercise/search Ìò∏Ï∂ú
                            $.ajax({
                                url: "/api/food/search",
                                method: "GET",
                                data: { name: selectedFoodName },
                                success: function (responseData) {
                                    // Î∞∞Ïó¥Ïù¥ Î∞òÌôòÎêòÏóàÏúºÎØÄÎ°ú Ï≤´ Î≤àÏß∏ ÏöîÏÜåÎ•º Í∞ÄÏ†∏ÏôÄÏÑú 'energyConsumption' Í∞íÏùÑ Ï∂îÏ∂ú
                                    if (responseData && responseData.length > 0) {
                                        let foodConsumption = responseData[0].calories;  // Ï≤´ Î≤àÏß∏ ÏöîÏÜåÏùò energyConsumption Í∞í
                                        console.log(foodConsumption);  // energyConsumption Í∞í ÌôïÏù∏

                                        // energyConsumption Í∞íÏùÑ ÌôîÎ©¥Ïóê Î∞òÏòÅ
                                        $(`#food_consumption_${item.id}`).val(foodConsumption);
                                    } else {
                                        // Í∞íÏù¥ ÏóÜÏúºÎ©¥ Îπà Í∞í Ï≤òÎ¶¨
                                        $(`#food_consumption_${item.id}`).val('');
                                    }
                                },
                                error: function (error) {
                                    console.error("Error fetching energy consumption:", error);
                                }
                            });
                        });

                    } else {
                        content += `<strong>ÏÉà ÏãùÎã® Ï∂îÍ∞Ä</strong><br>`;
                        content += `ÏùåÏãùÎ™Ö : <input type="text" class="foodName" id="foodName" onkeyup="updateFoodConsumption()" disabled/>`;
                        content += `<input type="text" class="foodConsumption" id="food_consumption" value="${foodConsumptionValue}" disabled/><br>`;
                        content += `ÏÑ≠Ï∑®Îüâ : <input type="text" class="foodHundredGram" id="foodHundredGram" onkeyup="calculateFoodCalories()" onfocus="calculateCalories()" /><br>`;
                        content += `ÏÑ≠Ï∑® ÏπºÎ°úÎ¶¨ : <input type="text" id="foodCalories" onkeyup="calculateFoodCalories()" disabled /><br>`;
                        content += `<button onclick="saveFood('${selectedDate}', ${memberId})">Ï†ÄÏû•</button>`;
                    }

                    content += `<button onClick="openSelectFoodWindow()">ÏùåÏãù ÏÑ†ÌÉù</button>`;

                    // Î™®Îã¨Ïóê Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // Î™®Îã¨ Ïó¥Í∏∞
                },
                error: function () {
                    $("#modalContent").html("ÏùºÏ†ïÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
                    $("#openModalBtn").click(); // Î™®Îã¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìä∏Î¶¨Í±∞
                }
            });
        }

        calendar.render();
    });


</script>

<!-- Î™®Îã¨ ÎùÑÏö∞Îäî Î≤ÑÌäº -->
<button type="button" class="btn btn-primary" id="openModalBtn" data-bs-toggle="modal" data-bs-target="#eventModal"
        style="display: none;">
    Open Modal
</button>

<!-- Î™®Îã¨ -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="eventModalLabel">Ïù¥Î≤§Ìä∏ ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalContent">
                ÏÑ†ÌÉùÌïú ÎÇ†ÏßúÏùò Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
