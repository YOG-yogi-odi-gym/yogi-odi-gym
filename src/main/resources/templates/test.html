<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº˜ë¦°ë”</title>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #calendar { max-width: 900px; margin: 50px auto; }
    </style>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.0.0/mdb.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.0.0/mdb.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body>


<h1>ìº˜ë¦°ë”</h1>

<p th:text="'Logged in as : ' + ${userEmail}"></p>
<p th:text="'Logged id : ' + ${memberId}"></p>
<p th:text="'userWeight : ' + ${userWeight}"></p>
<a href="/logout">Logout</a>
<input type="hidden" id="memberId" th:value="${memberId}" />
<input type="hidden" id="userWeight" onkeyup="calculateCalories()" th:value="${userWeight}"  />


<div id="calendar"></div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>


<script>

    function openSelectFoodWindow() {
        window.open("/select_food", "SelectFood", "width=600,height=400,scrollbars=yes,resizable=yes");
    }

    function openSelectExerciseWindow() {
        window.open("/select_exercise", "SelectExercise", "width=600,height=400,scrollbars=yes,resizable=yes");
    }

</script>

<script>
    function calculateCalories(id = null) {
        let time = id ? $(`#exerciseTime_${id}`).val() : $("#exerciseTime").val();
        let weight = $("#userWeight").val();
        let energyConsumption = id ? $(`#energy_consumption_${id}`).val() : $("#energy_consumption").val();

        if (time && weight && energyConsumption) {
            let calories = energyConsumption * 3.5 * weight * time * 0.005;
            if (id) {
                $(`#exerciseCalories_${id}`).val(calories.toFixed(2));
            } else {
                $("#exerciseCalories").val(calories.toFixed(2));
            }
        }
    }

    // ğŸ”¹ ìš´ë™ ì„ íƒ ì‹œ energy_consumption ì—…ë°ì´íŠ¸
    function updateEnergyConsumption(id = null) {
        let energyConsumptionValue = $("#selectedExerciseEnergy").val();
        if (id) {
            $(`#energy_consumption_${id}`).val(energyConsumptionValue);
            calculateCalories(id);
        } else {
            $("#energy_consumption").val(energyConsumptionValue);
            calculateCalories();
        }
    }
</script>



<script>

    function calculateFoodCalories(id = null) {
        let hundredGram = id ? $(`#foodHundredGram_${id}`).val() : $("#foodHundredGram").val();
        let foodConsumption = id ? $(`#food_consumption_${id}`).val() : $("#food_consumption").val();

        if (hundredGram && foodConsumption) {
            let calories = (hundredGram * foodConsumption * 0.01);
            console.log("ì¹¼ë¡œë¦¬ ê³„ì‚° : " + calories);
            if (id) {
                $(`#foodCalories_${id}`).val(calories.toFixed(2));
            } else {
                $("#foodCalories").val(calories.toFixed(2));
            }
        }
    }

    function updateFoodConsumption(id = null) {
        let foodConsumptionValue = $("#selectedFoodEnergy").val();

        // í™•ì¸: foodConsumptionValueê°€ ì˜ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
        console.log("foodConsumptionValue: ", foodConsumptionValue);

        if (id) {
            $(`#food_consumption_${id}`).val(foodConsumptionValue); // foodConsumption ê°’ ê°±ì‹ 
            calculateFoodCalories(id);  // foodConsumption ê°’ìœ¼ë¡œ ì¹¼ë¡œë¦¬ ê³„ì‚°
        } else {
            $("#food_consumption").val(foodConsumptionValue);
            calculateFoodCalories();  // foodConsumption ê°’ìœ¼ë¡œ ì¹¼ë¡œë¦¬ ê³„ì‚°
        }
    }
</script>



<script>

    function saveMemo(selectedDate, memberId) {
        let title = $("#memoTitle").val();
        let context = $("#memoContent").val();

        $.ajax({
            url: "/memo/date/post",
            method: "POST",
            data: {
                title: title,
                context: context,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function() {
                alert("ë©”ëª¨ ì €ì¥ ì‹¤íŒ¨");
            }
        });
    }

    function updateMemo(memoId, selectedDate, memberId) {
        let title = $(`#memoTitle_${memoId}`).val(); // ê° ë©”ëª¨ì˜ IDë¥¼ ê°€ì ¸ì˜¤ê¸°
        let context = $(`#memoContent_${memoId}`).val();
        console.log("ê°€ì ¸ì˜¨ ê°’ : "+title+context);

        $.ajax({
            url: "/memo/date/put",
            method: "PUT",
            data: {
                id: memoId,
                title: title,
                context: context,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ë©”ëª¨ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + xhr.responseText);
            }
        });
    }

    function deleteMemo(memoId) {

        $.ajax({
            url: "/memo/date/delete",
            method: "DELETE",
            data: {
                id: memoId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ë©”ëª¨ ì‚­ì œ ì‹¤íŒ¨: " + xhr.responseText);
            }
        });
    }

    function saveFood(selectedDate, memberId) {
        let name = $("#foodName").val();
        let hundredGram = $("#foodHundredGram").val();
        let calories = $("#foodCalories").val();

        $.ajax({
            url: "/food/date/post",
            method: "POST",
            data: {
                name: name,
                hundredGram: hundredGram,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function() {
                alert("ì‹ë‹¨ ì €ì¥ ì‹¤íŒ¨");
            }
        });
    }

    function updateFood(foodId, selectedDate, memberId) {
        let name = $(`#foodName_${foodId}`).val(); // ê° ë©”ëª¨ì˜ IDë¥¼ ê°€ì ¸ì˜¤ê¸°
        let hundredGram = $(`#foodHundredGram_${foodId}`).val();
        let calories = $(`#foodCalories_${foodId}`).val();


        $.ajax({
            url: "/food/date/put",
            method: "PUT",
            data: {
                id: foodId,
                name: name,
                hundredGram: hundredGram,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ì‹ë‹¨ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + xhr.responseText);
            }
        });
    }

    function deleteFood(foodId) {

        $.ajax({
            url: "/food/date/delete",
            method: "DELETE",
            data: {
                id: foodId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ì‹ë‹¨ ì‚­ì œ ì‹¤íŒ¨: " + xhr.responseText);
            }
        });
    }

    function saveExercise(selectedDate, memberId) {
        let name = $("#exerciseName").val();
        let time = $("#exerciseTime").val();
        let calories = $("#exerciseCalories").val();

        $.ajax({
            url: "/exercise/date/post",
            method: "POST",
            data: {
                name: name,
                time: time,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {},
            error: function() {
                alert("ìš´ë™ ì €ì¥ ì‹¤íŒ¨");
            }
        });
    }


    function updateExercise(exerciseId, selectedDate, memberId) {
        let name = $(`#exerciseName_${exerciseId}`).val(); // ê° ë©”ëª¨ì˜ IDë¥¼ ê°€ì ¸ì˜¤ê¸°
        let time = $(`#exerciseTime_${exerciseId}`).val();
        let calories = $(`#exerciseCalories_${exerciseId}`).val();

        $.ajax({
            url: "/exercise/date/put",
            method: "PUT",
            data: {
                id: exerciseId,
                name: name,
                time: time,
                calories: calories,
                date: selectedDate,
                memberId: memberId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ìš´ë™ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + xhr.responseText);
            }
        });
    }

    function deleteExercise(exerciseId) {

        $.ajax({
            url: "/exercise/date/delete",
            method: "DELETE",
            data: {
                id: exerciseId
            },
            success: function(response) {
            },
            error: function(xhr) {
                alert("ìš´ë™ ì‚­ì œ ì‹¤íŒ¨: " + xhr.responseText);
            }
        });
    }

    
    document.addEventListener("DOMContentLoaded", function () {

        let status = "";
        let calendarEl = document.getElementById("calendar");
        let calendar = new FullCalendar.Calendar(calendarEl, {
            themeSystem: 'bootstrap5',
            locale: "en",
            initialView: 'dayGridMonth',
            editable: false,
            selectable: false,
            navLinks: true,

            navLinkDayClick: function (date, jsEvent) {
                // íƒ€ì„ì¡´ ì˜¤í”„ì…‹ì„ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ê³„ì‚°
                let timezoneOffset = date.getTimezoneOffset() * 60000; // ë¶„ ë‹¨ìœ„ ì˜¤í”„ì…‹ì„ ë°€ë¦¬ì´ˆë¡œ ë³€í™˜

                // ì‹œê°„ëŒ€ ì¡°ì •: í´ë¦­í•œ ë‚ ì§œì—ì„œ íƒ€ì„ì¡´ ì˜¤í”„ì…‹ì„ ì ìš©
                let adjustedDate = new Date(date.getTime() - timezoneOffset); // ì˜¤í”„ì…‹ì„ ë¹¼ì„œ UTC ì‹œê°„ìœ¼ë¡œ ë³€í™˜

                if (this.view.type === "multiMonthYear") {
                    this.changeView("dayGridMonth"); // ì›”ë³„ ë³´ê¸°ë¡œ ë³€ê²½
                    this.gotoDate(adjustedDate); // ì¡°ì •ëœ ë‚ ì§œë¡œ ì´ë™
                } else if (status == 1) {
                    loadLesson2Events(adjustedDate);
                } else if (status == 2) {
                    Food2Action(adjustedDate);
                } else if (status == 3) {
                    Exercise2Action(adjustedDate);
                } else if (status == 4) {
                    Memo2Action(adjustedDate);
                } else {
                    status = "";
                    alert("modal");
                }

                // ë‚ ì§œì™€ ì¢Œí‘œ ì¶œë ¥
                console.log('day', adjustedDate.toISOString());
                console.log('coords', jsEvent.pageX, jsEvent.pageY);
            },

            headerToolbar: {
                left: 'today LessonButton FoodButton ExerButton MemoButton',
                center: 'title',
                right: 'prev,next,multiMonthYear'
            },

            customButtons: {
                LessonButton: {text: 'ê°•ì˜', click: loadLessonEvents},
                FoodButton: {text: 'ìŒì‹', click: FoodAction},
                ExerButton: {text: 'ìš´ë™', click: ExerciseAction},
                MemoButton: {text: 'ë©”ëª¨', click: MemoAction},
                multiMonthYear: {
                    icon: "bi bi-calendar",
                    click: function() {
                        calendar.changeView("multiMonthYear");
                    }
                }
            }
        });

        function loadLessonEvents() {
            status = 1;
            let memberId = document.getElementById('memberId').value;
            $.ajax({
                url: '/lesson',
                method: 'GET',
                data: { memberId: memberId },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let events = data.map(item => ({
                        title: item.title,
                        start: new Date(item.date),
                        end: new Date(new Date(item.date).setHours(new Date(item.date).getHours() + 2)),
                        description: `${item.startTime} - ${item.endTime}`,
                        allDay: true
                    }));

                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });
        }

        function loadLesson2Events(date) {
            let selectedDate = date.toISOString().split('T')[0]; // 'YYYY-MM-DD' í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            let memberId = document.getElementById('memberId').value;
            console.log("ì„ íƒí•œ ë‚ ì§œ:", selectedDate);

            $.ajax({
                url: '/lesson/date', // API ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •
                method: 'GET',
                data: {
                    memberId: memberId, // íšŒì› ID ì „ë‹¬
                    date: selectedDate // ì„ íƒí•œ ë‚ ì§œ ì „ë‹¬
                },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let content = `<strong>${selectedDate}ì˜ ê°•ì˜ ì¼ì •</strong><br>`;
                    if (data.length > 0) {
                        data.forEach(item => {
                            content += `<strong>${item.title}</strong> (${item.startTime} ~ ${item.endTime})`;
                            content += `<input type="button" class="lessonDetailBtn btn btn-info mt-2" value="ê°•ì˜ ìƒì„¸ë³´ê¸°" data-id="${item.id}" /><br>`;
                        });
                    } else {
                        content += "í•´ë‹¹ ë‚ ì§œì— ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.";
                    }

                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°

                    $(".lessonDetailBtn").on("click", function () {
                        let id = $(this).data("id");
                        window.location.href = `/detail/${id}`; // ê°•ì˜ ìƒì„¸ í˜ì´ì§€ ì´ë™
                    });
                },
                error: function () {
                    $("#modalContent").html("ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                }
            });
        }

        function MemoAction() {
            status = 4;
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/memo',
                method: 'GET',
                data: { memberId: memberId },
                success: function (data) {
                    let events = data.map(item => ({
                        title: item.title,
                        start: new Date(item.date),
                        description: item.context || "",
                        allDay: true
                    }));
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }


        function Memo2Action(date) {
            let selectedDate = date.toISOString().split('T')[0];
            let memberId = document.getElementById('memberId').value;
            console.log("ë°›ì€ ë‚ ì§œ:", selectedDate);

            $.ajax({
                url: '/memo/date',
                method: 'GET',
                data: {
                    date: selectedDate,
                    memberId: memberId
                },
                success: function (data) {
                    console.log('Received Memos:', data);

                    let content = `<strong>${selectedDate}ì˜ ë©”ëª¨</strong><br>`;

                    if (data.length > 0) {
                        // ê¸°ì¡´ ë©”ëª¨ê°€ ìˆì„ ê²½ìš° ìˆ˜ì • UI ìƒì„±
                        data.forEach(item => {
                            content += `<strong>ë©”ëª¨ ìˆ˜ì •</strong><br>`;
                            content += `ì œëª© : <input type="text" id="memoTitle_${item.id}" value="${item.title}" /><br>`;
                            content += `ë‚´ìš© : <textarea id="memoContent_${item.id}">${item.context}</textarea><br>`;
                            content += `<button onclick="updateMemo(${item.id}, '${selectedDate}', ${memberId})">ìˆ˜ì •</button>`;
                            content += `<button onclick="deleteMemo(${item.id})">ì‚­ì œ</button>`;
                        });

                    } else {
                        // ê¸°ì¡´ ë©”ëª¨ê°€ ì—†ì„ ê²½ìš° ì…ë ¥ í¼ ì¶”ê°€
                        content += `<strong>ìƒˆ ë©”ëª¨ ì¶”ê°€</strong><br>`;
                        content += `ì œëª© : <input type="text" id="memoTitle" placeholder="ì œëª© ì…ë ¥"> <br>`;
                        content += `ë‚´ìš© : <textarea id="memoContent" placeholder="ë‚´ìš© ì…ë ¥"></textarea> <br>`;
                        content += `<button onclick="saveMemo('${selectedDate}', ${memberId})">ì €ì¥</button>`;
                    }

                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°

                },
                error: function () {
                    $("#modalContent").html("ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                }
            });
        }


        function ExerciseAction() {
            status = 3;
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/exercise',  // ì‹¤ì œ API URLë¡œ ë³€ê²½
                method: 'GET',
                data: { memberId: memberId },
                success: function (data) {
                    let events = data.map(item => ({
                        title: item.name,
                        start: new Date(item.date),
                        description: item.context || "",
                        allDay: true
                    }));
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        function Exercise2Action(date) {
            let selectedDate = date.toISOString().split('T')[0];
            let memberId = document.getElementById('memberId').value;
            console.log("ë°›ì€ë‚ ì§œ", selectedDate);

            $.ajax({
                url: '/exercise/date',
                method: 'GET',
                data: {
                    date: selectedDate,
                    memberId: memberId
                },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let content = `<strong>${selectedDate}ì˜ ìš´ë™</strong><br>`;
                    let energyConsumptionValue = $("#selectedExerciseEnergy").val(); // ê¸°ë³¸ê°’ ì„¤ì •

                    if (data.length > 0) {
                        data.forEach(item => {
                            content += `<strong>ìš´ë™ ìˆ˜ì •</strong><br>`;
                            content += `ìš´ë™ëª… : <input type="text" class="exerciseName" id="exerciseName_${item.id}" value="${item.name}" onkeyup="updateEnergyConsumption(${item.id})" disabled/><br>`;
                            content += `ìš´ë™ì‹œê°„ : <input type="text" class="exerciseTime" id="exerciseTime_${item.id}" value="${item.time}" onkeyup="calculateCalories(${item.id})" onfocus="calculateCalories(${item.id})"/>`;
                            content += `<input type="text" class="energyConsumption" id="energy_consumption_${item.id}" value="${energyConsumptionValue}" disabled/><br>`;
                            content += `ìš´ë™ ì¹¼ë¡œë¦¬ : <input type="text" id="exerciseCalories_${item.id}" value="${item.calories}" onkeyup="calculateCalories()" disabled /><br>`;
                            content += `<button onclick="updateExercise(${item.id}, '${selectedDate}', ${memberId})">ìˆ˜ì •</button>`;
                            content += `<button onclick="deleteExercise(${item.id})">ì‚­ì œ</button>`;

                            $("#modalContent").html(content);


                            let selectedExerciseName = $(`#exerciseName_${item.id}`).val();
                            console.log(selectedExerciseName);

                            // /api/exercise/search í˜¸ì¶œ
                            $.ajax({
                                url: "/api/exercise/search",
                                method: "GET",
                                data: { name: selectedExerciseName },
                                success: function (responseData) {
                                    // ë°°ì—´ì´ ë°˜í™˜ë˜ì—ˆìœ¼ë¯€ë¡œ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ê°€ì ¸ì™€ì„œ 'energyConsumption' ê°’ì„ ì¶”ì¶œ
                                    if (responseData && responseData.length > 0) {
                                        let energyConsumption = responseData[0].energyConsumption;  // ì²« ë²ˆì§¸ ìš”ì†Œì˜ energyConsumption ê°’
                                        console.log(energyConsumption);  // energyConsumption ê°’ í™•ì¸

                                        // energyConsumption ê°’ì„ í™”ë©´ì— ë°˜ì˜
                                        $(`#energy_consumption_${item.id}`).val(energyConsumption);
                                    } else {
                                        // ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ê°’ ì²˜ë¦¬
                                        $(`#energy_consumption_${item.id}`).val('');
                                    }
                                },
                                error: function (error) {
                                    console.error("Error fetching energy consumption:", error);
                                }
                            });
                        });
                    } else {
                        content += `<strong>ìƒˆ ìš´ë™ ì¶”ê°€</strong><br>`;
                        content += `ìš´ë™ëª… : <input type="text" class="exerciseName" id="exerciseName" onkeyup="updateEnergyConsumption()" disabled/><br>`;
                        content += `ìš´ë™ì‹œê°„ : <input type="text" class="exerciseTime" id="exerciseTime" onkeyup="calculateCalories()" onfocus="calculateCalories()"/>`;
                        content += `<input type="text" class="energyConsumption" id="energy_consumption" value="${energyConsumptionValue}" disabled/><br>`;
                        content += `ìš´ë™ ì¹¼ë¡œë¦¬ : <input type="text" id="exerciseCalories" onkeyup="calculateCalories()" disabled /><br>`;
                        content += `<button onclick="saveExercise('${selectedDate}', ${memberId})">ì €ì¥</button>`;
                    }

                    content += `<button onClick="openSelectExerciseWindow()">ìš´ë™ ì„ íƒ</button>`;

                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                },
                error: function () {
                    $("#modalContent").html("ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                }
            });
        }


        function FoodAction() {
            status = 2;
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/food',  // ì‹¤ì œ API URLë¡œ ë³€ê²½
                method: 'GET',
                data: {memberId: memberId},
                success: function (data) {
                    let events = data.map(item => ({
                        title: item.name,
                        start: new Date(item.date),
                        description: item.context || "",
                        allDay: true
                    }));
                    calendar.removeAllEvents();
                    calendar.addEventSource(events);
                },
                error: function () {
                    alert('ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        function Food2Action(date) {
            let selectedDate = date.toISOString().split('T')[0];
            let memberId = document.getElementById('memberId').value;

            $.ajax({
                url: '/food/date',
                method: 'GET',
                data: {
                    date: selectedDate,
                    memberId: memberId
                },
                success: function (data) {
                    console.log('Received Lessons:', data);

                    let content = `<strong>${selectedDate}ì˜ ì‹ë‹¨</strong><br>`;
                    let foodConsumptionValue = $("#selectedFoodEnergy").val(); // ê¸°ë³¸ê°’ ì„¤ì •


                    if (data.length > 0) {
                        data.forEach(item => {
                            content += `<strong>ì‹ë‹¨ ìˆ˜ì •</strong><br>`;
                            content += `ìŒì‹ëª… : <input type="text" class="foodName" id="foodName_${item.id}" value="${item.name}" onkeyup="updateFoodConsumption(${item.id})" disabled /><br>`;
                            content += `<input type="text" class="foodConsumption" id="food_consumption_${item.id}" value="${foodConsumptionValue}" disabled/><br>`;
                            content += `ì„­ì·¨ëŸ‰ : <input type="text" class="foodHundredGram" id="foodHundredGram_${item.id}" value="${item.hundredGram}" onkeyup="calculateFoodCalories(${item.id})" onfocus="calculateFoodCalories(${item.id})" /><br>`;
                            content += `ì„­ì·¨ ì¹¼ë¡œë¦¬ : <input type="text" id="foodCalories_${item.id}" value="${item.calories}" disabled onkeyup="calculateFoodCalories(${item.id})" /><br>`;
                            content += `<button onclick="updateFood(${item.id}, '${selectedDate}', ${memberId})">ìˆ˜ì •</button>`;
                            content += `<button onclick="deleteFood(${item.id})">ì‚­ì œ</button>`;

                            $("#modalContent").html(content);

                            let selectedFoodName = $(`#foodName_${item.id}`).val();
                            console.log(selectedFoodName);


                            // /api/exercise/search í˜¸ì¶œ
                            $.ajax({
                                url: "/api/food/search",
                                method: "GET",
                                data: { name: selectedFoodName },
                                success: function (responseData) {
                                    // ë°°ì—´ì´ ë°˜í™˜ë˜ì—ˆìœ¼ë¯€ë¡œ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ê°€ì ¸ì™€ì„œ 'energyConsumption' ê°’ì„ ì¶”ì¶œ
                                    if (responseData && responseData.length > 0) {
                                        let foodConsumption = responseData[0].calories;  // ì²« ë²ˆì§¸ ìš”ì†Œì˜ energyConsumption ê°’
                                        console.log(foodConsumption);  // energyConsumption ê°’ í™•ì¸

                                        // energyConsumption ê°’ì„ í™”ë©´ì— ë°˜ì˜
                                        $(`#food_consumption_${item.id}`).val(foodConsumption);
                                    } else {
                                        // ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ê°’ ì²˜ë¦¬
                                        $(`#food_consumption_${item.id}`).val('');
                                    }
                                },
                                error: function (error) {
                                    console.error("Error fetching energy consumption:", error);
                                }
                            });
                        });

                    } else {
                        content += `<strong>ìƒˆ ì‹ë‹¨ ì¶”ê°€</strong><br>`;
                        content += `ìŒì‹ëª… : <input type="text" class="foodName" id="foodName" onkeyup="updateFoodConsumption()" disabled/>`;
                        content += `<input type="text" class="foodConsumption" id="food_consumption" value="${foodConsumptionValue}" disabled/><br>`;
                        content += `ì„­ì·¨ëŸ‰ : <input type="text" class="foodHundredGram" id="foodHundredGram" onkeyup="calculateFoodCalories()" onfocus="calculateCalories()" /><br>`;
                        content += `ì„­ì·¨ ì¹¼ë¡œë¦¬ : <input type="text" id="foodCalories" onkeyup="calculateFoodCalories()" disabled /><br>`;
                        content += `<button onclick="saveFood('${selectedDate}', ${memberId})">ì €ì¥</button>`;
                    }

                    content += `<button onClick="openSelectFoodWindow()">ìŒì‹ ì„ íƒ</button>`;

                    // ëª¨ë‹¬ì— ê¸°ë³¸ ë°ì´í„° ì¶”ê°€
                    $("#modalContent").html(content);
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ì—´ê¸°
                },
                error: function () {
                    $("#modalContent").html("ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    $("#openModalBtn").click(); // ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                }
            });
        }

        calendar.render();
    });


</script>

<!-- ëª¨ë‹¬ ë„ìš°ëŠ” ë²„íŠ¼ -->
<button type="button" class="btn btn-primary" id="openModalBtn" data-bs-toggle="modal" data-bs-target="#eventModal"
        style="display: none;">
    Open Modal
</button>

<!-- ëª¨ë‹¬ -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="eventModalLabel">ì´ë²¤íŠ¸ ìƒì„¸ ì •ë³´</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalContent">
                ì„ íƒí•œ ë‚ ì§œì˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
