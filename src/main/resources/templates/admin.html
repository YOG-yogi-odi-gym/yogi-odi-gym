<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>관리자 페이지</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .table-list {
            width: 70%;
            margin-top: 50px;
            margin-left: auto;
            margin-right: auto;
        }

        .member-controller {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 50%;
        }

        .table-container{
            width: 100%;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }

        .table thead th {
            position: sticky;
            z-index: 1;
            top: 0;
            vertical-align: middle;
            text-align: center;
        }

        .table tbody td {
            vertical-align: middle;
            text-align: center;
        }

        .table th, .table td {
            word-wrap: break-word;
        }

        .table th:nth-child(1), .table td:nth-child(1) {
            width: 50px;
        }

        .table th:nth-child(2), .table td:nth-child(2) {
            width: 100px;
        }

        .table th:nth-child(3), .table td:nth-child(3) {
            width: 200px;
        }

        .table th:nth-child(4), .table td:nth-child(4) {
            width: 100px;
        }

        .search-container {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        #searchInput {
            width: 250px;
        }

        #deleteButton {
            width: 100px;
            margin-top: 15px;
            align-self: flex-end;
        }
    </style>
</head>
<body>
<div class="container table-list">
    <h1 class="mb-4 text-center">회원 목록</h1>

    <div class="member-controller">
        <div class="search-container">
            <input type="text" id="searchInput" name="keyword" class="form-control" placeholder="이름 또는 이메일 검색...">
            <button id="searchButton" class="btn btn-primary ml-2">검색</button>
        </div>
        <div class="table-container">
            <table class="table table-bordered table-striped table-hover">
                <thead class="thead-dark">
                <tr>
                    <th>선택</th>
                    <th>이름</th>
                    <th>이메일</th>
                    <th>성별</th>
                </tr>
                </thead>
                <tbody id="memberTableBody">
                <tr th:each="member : ${members}">
                    <td><input type="checkbox"> </td>
                    <td th:text="${member.name}"></td>
                    <td th:text="${member.email}"></td>
                    <td th:text="${member.gender}"></td>
                </tr>
                </tbody>
        </table>
        </div>
        <button class="btn btn-danger" id="deleteButton">회원 삭제</button>
    </div>
</div>

<script>
    $(document).ready(function () {
        function searchMembers() {
            let keyword = $("#searchInput").val().trim();
            let requestUrl = keyword === ""
                ? "/api/members/search"
                : `/api/members/search?keyword=${keyword}`;


            $.ajax({
                url: "/api/admin/member/search",
                type: "GET",
                data: { keyword: keyword },
                success: function (response) {
                    if (response.status !== 200) {
                        alert("검색에 실패했습니다.");
                        return;
                    }

                    let members = response.data; // HttpResponseDto의 data 필드
                    let tableBody = $("#memberTableBody");
                    tableBody.empty();

                    if (members.length === 0) {
                        tableBody.append("<tr><td colspan='3' class='text-center'>검색 결과가 없습니다.</td></tr>");
                        return;
                    }

                    members.forEach(member => {
                        let row = `<tr>
                        <td><input type="checkbox"> </td>
                        <td>${member.name}</td>
                        <td>${member.email}</td>
                        <td>${member.gender}</td>
                    </tr>`;
                        tableBody.append(row);
                    });
                },
                error: function () {
                    alert("검색 중 오류가 발생했습니다.");
                }
            });
        }

        $("#searchButton").click(function () {
            searchMembers();
        });

        $("#searchInput").keypress(function (event) {
            if (event.which === 13) {
                searchMembers();
            }
        });
    });
</script>

</body>
</html>
